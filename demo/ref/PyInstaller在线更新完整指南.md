# PyInstalleråœ¨çº¿æ›´æ–°å®Œæ•´æŒ‡å— - è¶…çº§å°ç™½ç‰ˆ

## ğŸ¯ é—®é¢˜èƒŒæ™¯

ä½ æœ‰ä¸€ä¸ªç”¨PyQt5å¼€å‘çš„åº”ç”¨ç¨‹åºï¼Œä½¿ç”¨äº†condaç¯å¢ƒå’Œå„ç§ä¾èµ–åŒ…ï¼ˆå¦‚PaddleOCRç­‰ï¼‰ã€‚ç°åœ¨ä½ æƒ³ï¼š

1. **ç”¨PyInstalleræ‰“åŒ…æˆexeæ–‡ä»¶**å‘å¸ƒç»™ç”¨æˆ·
2. **å®ç°åœ¨çº¿æ›´æ–°åŠŸèƒ½**ï¼Œè®©ç”¨æˆ·å¯ä»¥è‡ªåŠ¨æ›´æ–°åˆ°æ–°ç‰ˆæœ¬
3. **æ”¯æŒç¯å¢ƒå˜åŒ–**ï¼Œæ¯”å¦‚æ–°ç‰ˆæœ¬æ·»åŠ äº†æ–°çš„ä¾èµ–åŒ…

ä½†æ˜¯é‡åˆ°äº†ä¸€ä¸ªå…³é”®é—®é¢˜ï¼š**PyInstalleræ‰“åŒ…åçš„exeæ–‡ä»¶åœ¨è¿è¡Œæ—¶æ— æ³•è‡ªæˆ‘æ›¿æ¢ï¼**

## ğŸ” ä¸ºä»€ä¹ˆæ™®é€šçš„æ›´æ–°æ–¹æ¡ˆä¸è¡Œï¼Ÿ

### âŒ é—®é¢˜1ï¼šæ–‡ä»¶é”å®š

```
âŒ è¿™æ ·ä¸è¡Œï¼š
MyApp.exe (æ­£åœ¨è¿è¡Œ) â†’ å°è¯•æ›¿æ¢è‡ªå·± â†’ Windowsè¯´ï¼šæ–‡ä»¶è¢«å ç”¨ï¼Œæ— æ³•æ›¿æ¢
```

### âŒ é—®é¢˜2ï¼šç¯å¢ƒæ‰“åŒ…

```
âŒ è¿™æ ·ä¸è¡Œï¼š
å½“å‰demoçš„æ›´æ–°æ–¹æ¡ˆ â†’ æ›¿æ¢Pythonæºç æ–‡ä»¶ â†’ ä½†PyInstallerå·²ç»æŠŠæ‰€æœ‰ä¸œè¥¿æ‰“åŒ…è¿›exeäº†
```

## âœ… è§£å†³æ–¹æ¡ˆï¼šåŒç¨‹åºæ›´æ–°æ¨¡å¼

### æ ¸å¿ƒæ€è·¯

```
ğŸ¯ å…³é”®æ€è·¯ï¼š
ä¸è®©ç¨‹åºè‡ªå·±æ›´æ–°è‡ªå·±ï¼Œè€Œæ˜¯è®©å¦ä¸€ä¸ªç¨‹åºæ¥æ›´æ–°å®ƒï¼
```

## ğŸ“ æ–°çš„é¡¹ç›®ç»“æ„

```
å‘å¸ƒç»™ç”¨æˆ·çš„æ–‡ä»¶å¤¹ï¼š
MyKuzflowApp/
â”œâ”€â”€ KuzflowApp.exe          â† ä¸»ç¨‹åºï¼ˆä½ çš„åº”ç”¨ï¼‰
â”œâ”€â”€ updater.exe             â† æ›´æ–°å™¨ç¨‹åºï¼ˆä¸“é—¨è´Ÿè´£æ›´æ–°ï¼‰
â”œâ”€â”€ config/
â”‚   â””â”€â”€ update_config.json  â† æ›´æ–°é…ç½®
â”œâ”€â”€ data/                   â† ç”¨æˆ·æ•°æ®ï¼ˆæ›´æ–°æ—¶ä¿ç•™ï¼‰
â”‚   â””â”€â”€ user_settings.json
â””â”€â”€ temp/                   â† ä¸´æ—¶æ–‡ä»¶å¤¹
```

## ğŸ”„ æ›´æ–°æµç¨‹è¯¦è§£

### ç¬¬1æ­¥ï¼šæ£€æŸ¥æ›´æ–°

```
KuzflowApp.exe å¯åŠ¨
         â†“
    è”ç½‘æ£€æŸ¥æœåŠ¡å™¨
         â†“
   å‘ç°æœ‰æ–°ç‰ˆæœ¬v1.1.0
         â†“
    å¼¹å‡ºæ›´æ–°å¯¹è¯æ¡†
```

### ç¬¬2æ­¥ï¼šå¯åŠ¨æ›´æ–°å™¨

```
ç”¨æˆ·ç‚¹å‡»"ç«‹å³æ›´æ–°"
         â†“
KuzflowApp.exe å‘Šè¯‰ updater.exeï¼š"å¸®æˆ‘æ›´æ–°åˆ°v1.1.0"
         â†“
KuzflowApp.exe è‡ªå·±é€€å‡ºï¼ˆè¿™æ ·æ–‡ä»¶å°±ä¸è¢«é”å®šäº†ï¼‰
         â†“
updater.exe å¼€å§‹å·¥ä½œ
```

### ç¬¬3æ­¥ï¼šæ‰§è¡Œæ›´æ–°

```
updater.exe ä»æœåŠ¡å™¨ä¸‹è½½ new_KuzflowApp.exe
         â†“
å¤‡ä»½æ—§çš„ KuzflowApp.exeï¼ˆä»¥é˜²æ›´æ–°å¤±è´¥ï¼‰
         â†“
åˆ é™¤æ—§çš„ KuzflowApp.exe
         â†“
å°† new_KuzflowApp.exe é‡å‘½åä¸º KuzflowApp.exe
         â†“
å¯åŠ¨æ–°çš„ KuzflowApp.exe
         â†“
updater.exe è‡ªå·±é€€å‡º
```

## ğŸ“ è¯¦ç»†ä»£ç å®ç°

### 1. ä¸»ç¨‹åºä¸­çš„æ›´æ–°æ£€æŸ¥ä»£ç 

åœ¨ä½ çš„ä¸»ç¨‹åº `app.py` ä¸­æ·»åŠ ï¼š

```python
import subprocess
import json
from pathlib import Path

class KuzflowMainApp:
    def check_for_updates(self):
        """æ£€æŸ¥æ›´æ–°çš„å‡½æ•°"""
        try:
            # 1. è°ƒç”¨æœåŠ¡å™¨APIæ£€æŸ¥æ›´æ–°
            api_client = APIClient("http://your-server.com")
            success, update_info = api_client.check_version("1.0.0")  # å½“å‰ç‰ˆæœ¬
          
            if success and update_info.get("update_available"):
                # 2. å‘ç°æ›´æ–°ï¼Œè¯¢é—®ç”¨æˆ·
                reply = QMessageBox.question(
                    self,
                    "å‘ç°æ–°ç‰ˆæœ¬",
                    f"å‘ç°æ–°ç‰ˆæœ¬ {update_info['latest_version']}ï¼Œæ˜¯å¦ç«‹å³æ›´æ–°ï¼Ÿ",
                    QMessageBox.Yes | QMessageBox.No
                )
              
                if reply == QMessageBox.Yes:
                    # 3. ç”¨æˆ·ç¡®è®¤æ›´æ–°ï¼Œå¯åŠ¨æ›´æ–°å™¨
                    self.start_updater(update_info)
                  
        except Exception as e:
            QMessageBox.warning(self, "æ›´æ–°æ£€æŸ¥å¤±è´¥", f"æ— æ³•æ£€æŸ¥æ›´æ–°ï¼š{e}")
  
    def start_updater(self, update_info):
        """å¯åŠ¨æ›´æ–°å™¨ç¨‹åº"""
        try:
            # 1. æŠŠæ›´æ–°ä¿¡æ¯ä¿å­˜åˆ°æ–‡ä»¶ï¼Œè®©æ›´æ–°å™¨çŸ¥é“è¦ä¸‹è½½ä»€ä¹ˆ
            update_file = Path("temp/update_info.json")
            update_file.parent.mkdir(exist_ok=True)
          
            with open(update_file, 'w', encoding='utf-8') as f:
                json.dump(update_info, f, ensure_ascii=False, indent=2)
          
            # 2. å¯åŠ¨æ›´æ–°å™¨ç¨‹åº
            subprocess.Popen([
                "updater.exe",          # æ›´æ–°å™¨ç¨‹åº
                str(update_file),       # å‘Šè¯‰å®ƒæ›´æ–°ä¿¡æ¯æ–‡ä»¶åœ¨å“ª
                "KuzflowApp.exe"        # å‘Šè¯‰å®ƒè¦æ›´æ–°å“ªä¸ªæ–‡ä»¶
            ])
          
            # 3. ä¸»ç¨‹åºé€€å‡ºï¼Œé‡Šæ”¾æ–‡ä»¶é”
            self.close()
            QApplication.quit()
          
        except Exception as e:
            QMessageBox.critical(self, "å¯åŠ¨æ›´æ–°å™¨å¤±è´¥", f"æ— æ³•å¯åŠ¨æ›´æ–°ç¨‹åºï¼š{e}")
```

### 2. ç‹¬ç«‹çš„æ›´æ–°å™¨ç¨‹åº

åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶ `updater.py`ï¼š

```python
import sys
import os
import requests
import subprocess
import time
import json
import shutil
import hashlib
from pathlib import Path
import tempfile

def log_message(message):
    """è¾“å‡ºæ—¥å¿—ï¼ˆä½ å¯ä»¥æ”¹æˆå†™å…¥æ—¥å¿—æ–‡ä»¶ï¼‰"""
    print(f"[æ›´æ–°å™¨] {message}")
    # ä¹Ÿå¯ä»¥å†™å…¥æ—¥å¿—æ–‡ä»¶
    with open("updater.log", "a", encoding="utf-8") as f:
        f.write(f"{time.strftime('%Y-%m-%d %H:%M:%S')} [æ›´æ–°å™¨] {message}\n")

def download_file(url, local_path, expected_size=0):
    """ä¸‹è½½æ–‡ä»¶ï¼Œæ”¯æŒè¿›åº¦æ˜¾ç¤º"""
    log_message(f"å¼€å§‹ä¸‹è½½ï¼š{url}")
  
    try:
        response = requests.get(url, stream=True)
        response.raise_for_status()
      
        total_size = int(response.headers.get('content-length', 0))
        downloaded = 0
      
        with open(local_path, 'wb') as f:
            for chunk in response.iter_content(chunk_size=8192):
                if chunk:
                    f.write(chunk)
                    downloaded += len(chunk)
                  
                    # æ˜¾ç¤ºè¿›åº¦
                    if total_size > 0:
                        percent = (downloaded / total_size) * 100
                        log_message(f"ä¸‹è½½è¿›åº¦ï¼š{percent:.1f}%")
      
        log_message(f"ä¸‹è½½å®Œæˆï¼š{local_path}")
        return True
      
    except Exception as e:
        log_message(f"ä¸‹è½½å¤±è´¥ï¼š{e}")
        return False

def verify_file(file_path, expected_hash):
    """éªŒè¯æ–‡ä»¶å®Œæ•´æ€§"""
    if not expected_hash:
        return True  # å¦‚æœæ²¡æœ‰æä¾›å“ˆå¸Œï¼Œè·³è¿‡éªŒè¯
  
    log_message("éªŒè¯æ–‡ä»¶å®Œæ•´æ€§...")
  
    sha256_hash = hashlib.sha256()
    with open(file_path, "rb") as f:
        for chunk in iter(lambda: f.read(4096), b""):
            sha256_hash.update(chunk)
  
    actual_hash = sha256_hash.hexdigest()
  
    if actual_hash == expected_hash:
        log_message("æ–‡ä»¶å®Œæ•´æ€§éªŒè¯é€šè¿‡")
        return True
    else:
        log_message(f"æ–‡ä»¶å®Œæ•´æ€§éªŒè¯å¤±è´¥ï¼æœŸæœ›ï¼š{expected_hash}ï¼Œå®é™…ï¼š{actual_hash}")
        return False

def backup_old_version(app_exe_path):
    """å¤‡ä»½æ—§ç‰ˆæœ¬"""
    try:
        if os.path.exists(app_exe_path):
            backup_path = f"{app_exe_path}.backup_{int(time.time())}"
            shutil.copy2(app_exe_path, backup_path)
            log_message(f"å·²å¤‡ä»½æ—§ç‰ˆæœ¬åˆ°ï¼š{backup_path}")
            return backup_path
        return None
    except Exception as e:
        log_message(f"å¤‡ä»½å¤±è´¥ï¼š{e}")
        return None

def restore_backup(backup_path, app_exe_path):
    """æ¢å¤å¤‡ä»½"""
    try:
        if backup_path and os.path.exists(backup_path):
            shutil.move(backup_path, app_exe_path)
            log_message("å·²æ¢å¤åˆ°å¤‡ä»½ç‰ˆæœ¬")
            return True
    except Exception as e:
        log_message(f"æ¢å¤å¤‡ä»½å¤±è´¥ï¼š{e}")
    return False

def update_application():
    """ä¸»æ›´æ–°å‡½æ•°"""
    if len(sys.argv) < 3:
        log_message("å‚æ•°ä¸è¶³ï¼ç”¨æ³•ï¼šupdater.exe <update_info.json> <app_exe_name>")
        input("æŒ‰å›è½¦é”®é€€å‡º...")
        return False
  
    update_info_file = sys.argv[1]  # temp/update_info.json
    app_exe_name = sys.argv[2]      # KuzflowApp.exe
  
    try:
        # 1. è¯»å–æ›´æ–°ä¿¡æ¯
        log_message("è¯»å–æ›´æ–°ä¿¡æ¯...")
        with open(update_info_file, 'r', encoding='utf-8') as f:
            update_info = json.load(f)
      
        new_version = update_info['latest_version']
        download_url = update_info['download_url']
        expected_hash = update_info.get('file_hash', '')
      
        log_message(f"å‡†å¤‡æ›´æ–°åˆ°ç‰ˆæœ¬ï¼š{new_version}")
      
        # 2. ç­‰å¾…ä¸»ç¨‹åºå®Œå…¨é€€å‡º
        log_message("ç­‰å¾…ä¸»ç¨‹åºé€€å‡º...")
        time.sleep(2)  # ç­‰å¾…2ç§’ç¡®ä¿ä¸»ç¨‹åºå®Œå…¨é€€å‡º
      
        # 3. ä¸‹è½½æ–°ç‰ˆæœ¬åˆ°ä¸´æ—¶æ–‡ä»¶
        temp_dir = Path("temp")
        temp_dir.mkdir(exist_ok=True)
        temp_exe_path = temp_dir / f"new_{app_exe_name}"
      
        # æ„å»ºå®Œæ•´çš„ä¸‹è½½URL
        if not download_url.startswith("http"):
            # å¦‚æœæ˜¯ç›¸å¯¹URLï¼Œæ·»åŠ æœåŠ¡å™¨åœ°å€
            server_base = "http://127.0.0.1:8000"  # ä»é…ç½®æ–‡ä»¶è¯»å–
            download_url = f"{server_base}{download_url}"
      
        if not download_file(download_url, temp_exe_path):
            raise Exception("ä¸‹è½½æ–°ç‰ˆæœ¬å¤±è´¥")
      
        # 4. éªŒè¯æ–‡ä»¶
        if not verify_file(temp_exe_path, expected_hash):
            raise Exception("æ–‡ä»¶å®Œæ•´æ€§éªŒè¯å¤±è´¥")
      
        # 5. å¤‡ä»½æ—§ç‰ˆæœ¬
        backup_path = backup_old_version(app_exe_name)
      
        # 6. æ›¿æ¢ä¸»ç¨‹åº
        log_message("æ­£åœ¨æ›¿æ¢ä¸»ç¨‹åº...")
      
        # åˆ é™¤æ—§æ–‡ä»¶
        if os.path.exists(app_exe_name):
            os.remove(app_exe_name)
      
        # ç§»åŠ¨æ–°æ–‡ä»¶
        shutil.move(str(temp_exe_path), app_exe_name)
      
        log_message("ç¨‹åºæ›´æ–°å®Œæˆï¼")
      
        # 7. å¯åŠ¨æ–°ç‰ˆæœ¬
        log_message("å¯åŠ¨æ–°ç‰ˆæœ¬...")
        subprocess.Popen([app_exe_name])
      
        # 8. æ¸…ç†ä¸´æ—¶æ–‡ä»¶
        try:
            if os.path.exists(update_info_file):
                os.remove(update_info_file)
        except:
            pass
      
        log_message("æ›´æ–°æˆåŠŸå®Œæˆï¼")
        return True
      
    except Exception as e:
        log_message(f"æ›´æ–°å¤±è´¥ï¼š{e}")
      
        # å°è¯•æ¢å¤å¤‡ä»½
        if 'backup_path' in locals():
            log_message("å°è¯•æ¢å¤å¤‡ä»½...")
            restore_backup(backup_path, app_exe_name)
      
        input("æ›´æ–°å¤±è´¥ï¼æŒ‰å›è½¦é”®é€€å‡º...")
        return False

if __name__ == "__main__":
    print("=" * 50)
    print("Kuzflow åº”ç”¨æ›´æ–°å™¨")
    print("=" * 50)
  
    success = update_application()
  
    if not success:
        # å¦‚æœæ›´æ–°å¤±è´¥ï¼Œç­‰å¾…ç”¨æˆ·æŒ‰é”®
        input("æŒ‰å›è½¦é”®é€€å‡º...")
```

## ğŸ”§ PyInstalleræ„å»ºè„šæœ¬

åˆ›å»º `build.py` æ–‡ä»¶æ¥è‡ªåŠ¨åŒ–æ„å»ºè¿‡ç¨‹ï¼š

```python
import PyInstaller.__main__
import os
import shutil
from pathlib import Path

def clean_build():
    """æ¸…ç†ä¹‹å‰çš„æ„å»ºæ–‡ä»¶"""
    dirs_to_clean = ['build', 'dist', '__pycache__']
    for dir_name in dirs_to_clean:
        if os.path.exists(dir_name):
            shutil.rmtree(dir_name)
            print(f"å·²æ¸…ç†ï¼š{dir_name}")

def build_main_app():
    """æ„å»ºä¸»åº”ç”¨ç¨‹åº"""
    print("æ­£åœ¨æ„å»ºä¸»åº”ç”¨ç¨‹åº...")
  
    PyInstaller.__main__.run([
        'app.py',                           # ä½ çš„ä¸»ç¨‹åº
        '--name=KuzflowApp',               # ç”Ÿæˆçš„exeåç§°
        '--windowed',                      # æ— æ§åˆ¶å°çª—å£
        '--onefile',                       # æ‰“åŒ…æˆå•ä¸ªexeï¼ˆä¹Ÿå¯ä»¥ç”¨--onedirï¼‰
        '--add-data=config;config',        # åŒ…å«é…ç½®æ–‡ä»¶
        '--add-data=public;public',        # åŒ…å«èµ„æºæ–‡ä»¶
        '--hidden-import=paddle',          # éšå¼å¯¼å…¥PaddleOCR
        '--hidden-import=cv2',             # éšå¼å¯¼å…¥OpenCV
        '--icon=public/logo.ico',          # åº”ç”¨å›¾æ ‡
        '--distpath=release'               # è¾“å‡ºç›®å½•
    ])
  
    print("ä¸»åº”ç”¨ç¨‹åºæ„å»ºå®Œæˆï¼")

def build_updater():
    """æ„å»ºæ›´æ–°å™¨ç¨‹åº"""
    print("æ­£åœ¨æ„å»ºæ›´æ–°å™¨ç¨‹åº...")
  
    PyInstaller.__main__.run([
        'updater.py',                      # æ›´æ–°å™¨æºç 
        '--name=updater',                  # ç”Ÿæˆçš„exeåç§°
        '--console',                       # æ˜¾ç¤ºæ§åˆ¶å°ï¼ˆæ˜¾ç¤ºæ›´æ–°è¿›åº¦ï¼‰
        '--onefile',                       # å•ä¸ªexeæ–‡ä»¶
        '--distpath=release'               # è¾“å‡ºåˆ°åŒä¸€ç›®å½•
    ])
  
    print("æ›´æ–°å™¨ç¨‹åºæ„å»ºå®Œæˆï¼")

def create_release_structure():
    """åˆ›å»ºå‘å¸ƒç›®å½•ç»“æ„"""
    print("åˆ›å»ºå‘å¸ƒç›®å½•ç»“æ„...")
  
    release_dir = Path("release")
  
    # åˆ›å»ºå¿…è¦çš„ç›®å½•
    (release_dir / "config").mkdir(exist_ok=True)
    (release_dir / "data").mkdir(exist_ok=True)
    (release_dir / "temp").mkdir(exist_ok=True)
  
    # å¤åˆ¶é…ç½®æ–‡ä»¶
    if os.path.exists("config/update_config.json"):
        shutil.copy2("config/update_config.json", release_dir / "config/")
  
    # å¤åˆ¶ç‰ˆæœ¬æ–‡ä»¶
    if os.path.exists("version.txt"):
        shutil.copy2("version.txt", release_dir / "version.txt")
  
    print("å‘å¸ƒç›®å½•ç»“æ„åˆ›å»ºå®Œæˆï¼")

def main():
    """ä¸»æ„å»ºæµç¨‹"""
    print("å¼€å§‹æ„å»ºKuzflowåº”ç”¨ç¨‹åº...")
  
    # 1. æ¸…ç†æ—§æ–‡ä»¶
    clean_build()
  
    # 2. æ„å»ºä¸»ç¨‹åº
    build_main_app()
  
    # 3. æ„å»ºæ›´æ–°å™¨
    build_updater()
  
    # 4. åˆ›å»ºå‘å¸ƒç»“æ„
    create_release_structure()
  
    print("\n" + "=" * 50)
    print("æ„å»ºå®Œæˆï¼")
    print("å‘å¸ƒæ–‡ä»¶åœ¨ release/ ç›®å½•ä¸‹ï¼š")
    print("  - KuzflowApp.exe  (ä¸»ç¨‹åº)")
    print("  - updater.exe     (æ›´æ–°å™¨)")
    print("  - config/         (é…ç½®æ–‡ä»¶)")
    print("  - data/           (æ•°æ®ç›®å½•)")
    print("  - temp/           (ä¸´æ—¶ç›®å½•)")
    print("=" * 50)

if __name__ == "__main__":
    main()
```

## ğŸŒ æœåŠ¡ç«¯ä¿®æ”¹

ä½ çš„æœåŠ¡ç«¯éœ€è¦æ”¯æŒexeæ–‡ä»¶ä¸‹è½½ï¼Œä¿®æ”¹ `server/start.py`ï¼š

```python
@app.get("/api/version/download/{version}")
async def download_version(version: str):
    """ä¸‹è½½exeæ–‡ä»¶ç‰ˆæœ¬"""
    try:
        # exeæ–‡ä»¶è·¯å¾„
        exe_path = f"releases/v{version}/KuzflowApp.exe"
      
        if not os.path.exists(exe_path):
            raise HTTPException(status_code=404, detail="exeæ–‡ä»¶ä¸å­˜åœ¨")
      
        return FileResponse(
            exe_path,
            media_type='application/octet-stream',
            filename=f"KuzflowApp_v{version}.exe"
        )
      
    except Exception as e:
        raise HTTPException(status_code=500, detail=f"ä¸‹è½½å¤±è´¥: {str(e)}")

@app.get("/api/version/check")
async def check_version(current_version: str = Query(...)):
    """æ£€æŸ¥ç‰ˆæœ¬ï¼ˆè¿”å›exeä¸‹è½½é“¾æ¥ï¼‰"""
    # ... åŸæœ‰é€»è¾‘ ...
  
    return {
        "update_available": True,
        "latest_version": "1.1.0",
        "download_url": f"/api/version/download/1.1.0",  # ç›´æ¥ä¸‹è½½exe
        "file_size": os.path.getsize("releases/v1.1.0/KuzflowApp.exe"),
        "file_hash": calculate_file_hash("releases/v1.1.0/KuzflowApp.exe")
    }
```

## ğŸ“¦ å®Œæ•´çš„ä½¿ç”¨æµç¨‹

### 1. å¼€å‘é˜¶æ®µ

```bash
# 1. å¼€å‘ä½ çš„åº”ç”¨
python app.py

# 2. æµ‹è¯•æ›´æ–°åŠŸèƒ½
python updater.py
```

### 2. æ„å»ºé˜¶æ®µ

```bash
# ä¸€é”®æ„å»ºæ‰€æœ‰æ–‡ä»¶
python build.py
```

### 3. å‘å¸ƒé˜¶æ®µ

```bash
# å°† release/ ç›®å½•æ‰“åŒ…ç»™ç”¨æˆ·
zip -r KuzflowApp_v1.0.0.zip release/
```

### 4. ç”¨æˆ·ä½¿ç”¨

```
ç”¨æˆ·è§£å‹ â†’ è¿è¡Œ KuzflowApp.exe â†’ è‡ªåŠ¨æ£€æŸ¥æ›´æ–° â†’ ä¸€é”®æ›´æ–°
```

## âš ï¸ é‡è¦æ³¨æ„äº‹é¡¹

### 1. å®‰å…¨æ€§

```python
# éªŒè¯ä¸‹è½½çš„æ–‡ä»¶
def verify_download(file_path, expected_hash):
    # å¿…é¡»éªŒè¯æ–‡ä»¶å“ˆå¸Œï¼Œé˜²æ­¢ä¸‹è½½æŸåæˆ–è¢«ç¯¡æ”¹
    pass
```

### 2. é”™è¯¯å¤„ç†

```python
# æ›´æ–°å¤±è´¥æ—¶çš„å›æ»šæœºåˆ¶
try:
    update_process()
except Exception:
    restore_backup()  # æ¢å¤å¤‡ä»½
    show_error_to_user()  # é€šçŸ¥ç”¨æˆ·
```

### 3. ç”¨æˆ·ä½“éªŒ

```python
# æ˜¾ç¤ºæ›´æ–°è¿›åº¦
def show_progress(percent, message):
    print(f"æ›´æ–°è¿›åº¦ï¼š{percent}% - {message}")
```

## ğŸ¯ ç¯å¢ƒå˜åŒ–çš„å¤„ç†

### å¦‚æœæ–°ç‰ˆæœ¬æœ‰æ–°çš„ä¾èµ–ï¼š

1. **é‡æ–°æ„å»ºæ—¶åŒ…å«æ–°ä¾èµ–**ï¼š

```bash
pyinstaller --hidden-import=æ–°ä¾èµ–åŒ… app.py
```

2. **æœåŠ¡ç«¯è¿”å›æ›´å¤§çš„æ–‡ä»¶**ï¼š

```python
# æ–°ç‰ˆæœ¬çš„exeä¼šåŒ…å«æ‰€æœ‰æ–°ä¾èµ–
# ç”¨æˆ·ä¸‹è½½åç›´æ¥æ›¿æ¢å³å¯
```

3. **æ£€æµ‹ä¾èµ–å˜åŒ–**ï¼š

```python
# å¯ä»¥åœ¨ç‰ˆæœ¬ä¿¡æ¯ä¸­æ ‡è®°æ˜¯å¦æœ‰ä¾èµ–å˜åŒ–
{
    "version": "1.1.0",
    "dependencies_changed": true,  # æç¤ºç”¨æˆ·è¿™æ˜¯ä¸€ä¸ªå¤§æ›´æ–°
    "download_size": 50000000      # 50MBï¼ˆåŒ…å«æ–°ä¾èµ–ï¼‰
}
```

## ğŸš€ å®Œæ•´ç¤ºä¾‹é¡¹ç›®ç»“æ„

```
ä½ çš„é¡¹ç›®ç›®å½•ï¼š
kuzflow_project/
â”œâ”€â”€ app.py                  # ä¸»åº”ç”¨ç¨‹åº
â”œâ”€â”€ updater.py             # æ›´æ–°å™¨ç¨‹åº
â”œâ”€â”€ build.py               # æ„å»ºè„šæœ¬
â”œâ”€â”€ config/
â”‚   â””â”€â”€ update_config.json
â”œâ”€â”€ public/
â”‚   â””â”€â”€ logo.ico
â”œâ”€â”€ version.txt
â”œâ”€â”€ requirements.txt       # Pythonä¾èµ–
â””â”€â”€ release/              # æ„å»ºåçš„å‘å¸ƒæ–‡ä»¶
    â”œâ”€â”€ KuzflowApp.exe
    â”œâ”€â”€ updater.exe
    â”œâ”€â”€ config/
    â”œâ”€â”€ data/
    â””â”€â”€ temp/
```

## ğŸ’¡ å°ç™½å‹å¥½æç¤º

### Q: æˆ‘ä¸æ‡‚ç¼–ç¨‹ï¼Œæ€ä¹ˆä¿®æ”¹è¿™äº›ä»£ç ï¼Ÿ

**A**: ä½ åªéœ€è¦ï¼š

1. æŠŠä¸Šé¢çš„ä»£ç å¤åˆ¶åˆ°å¯¹åº”æ–‡ä»¶ä¸­
2. ä¿®æ”¹å‡ ä¸ªåœ°æ–¹çš„åç§°ï¼ˆæ¯”å¦‚æŠŠ"KuzflowApp"æ”¹æˆä½ çš„åº”ç”¨åï¼‰
3. è¿è¡Œ `python build.py` æ„å»º

### Q: å¦‚ä½•æµ‹è¯•æ›´æ–°åŠŸèƒ½ï¼Ÿ

**A**:

1. å…ˆæ„å»ºv1.0.0ç‰ˆæœ¬ç»™ç”¨æˆ·
2. ä¿®æ”¹ä»£ç åæ„å»ºv1.1.0ç‰ˆæœ¬æ”¾åˆ°æœåŠ¡å™¨
3. ç”¨æˆ·è¿è¡Œv1.0.0ï¼Œä¼šè‡ªåŠ¨æ£€æµ‹åˆ°v1.1.0å¹¶æ›´æ–°

### Q: ç”¨æˆ·ç”µè„‘æ²¡æœ‰Pythonç¯å¢ƒæ€ä¹ˆåŠï¼Ÿ

**A**: æ²¡å…³ç³»ï¼PyInstallerä¼šæŠŠæ‰€æœ‰éœ€è¦çš„Pythonç¯å¢ƒéƒ½æ‰“åŒ…è¿›exeæ–‡ä»¶ï¼Œç”¨æˆ·ä¸éœ€è¦å®‰è£…Pythonã€‚

### Q: æ›´æ–°å¤±è´¥äº†æ€ä¹ˆåŠï¼Ÿ

**A**: æ›´æ–°å™¨ä¼šè‡ªåŠ¨å¤‡ä»½æ—§ç‰ˆæœ¬ï¼Œå¤±è´¥æ—¶ä¼šè‡ªåŠ¨æ¢å¤ï¼Œç¡®ä¿ç”¨æˆ·çš„åº”ç”¨ä¸ä¼šæŸåã€‚

---

è¿™ä¸ªæ–¹æ¡ˆå®Œç¾è§£å†³äº†PyInstalleræ‰“åŒ…åçš„åœ¨çº¿æ›´æ–°é—®é¢˜ï¼Œæ”¯æŒç¯å¢ƒå˜åŒ–ï¼Œç”¨æˆ·ä½“éªŒè‰¯å¥½ï¼

æœ‰ä»»ä½•ä¸æ¸…æ¥šçš„åœ°æ–¹ï¼Œéšæ—¶é—®æˆ‘ï¼ ğŸ˜Š
